<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Profile Browser - Yoro Oy | Profiiliselain</title>
    <meta name="description" content="Browse and search suitable candidates from 27,717 person profiles | Selaa ja etsi sopivia ehdokkaita 27,717 henkil√∂profiilin joukosta"/>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- React and React DOM for component support -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Language Selector */
        .language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 25px;
            padding: 8px 16px;
            backdrop-filter: blur(10px);
        }

        .language-selector button {
            background: none;
            border: none;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 20px;
            margin: 0 2px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .language-selector button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .language-selector button.active {
            background: #007acc;
            color: white;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header h1 {
            font-size: 2rem;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header .nav-links {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .header .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .search-section h2 {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            text-align: center;
        }
        
        .search-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group select {
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-button {
            grid-column: 1 / -1;
            justify-self: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .search-button:active {
            transform: translateY(0);
        }
        
        .results-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .results-count {
            color: #666;
            font-size: 14px;
        }
        
        .pagination {
            display: flex;
            gap: 5px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .pagination button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover:not(:disabled) {
            background: #f0f0f0;
        }
        
        .pagination button.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .profile-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid #e1e1e1;
        }
        
        .profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .profile-id {
            font-size: 0.9rem;
            color: #667eea;
            font-weight: 600;
        }
        
        .lxp-code {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .profile-details {
            margin-bottom: 1rem;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .detail-label {
            font-weight: 600;
            color: #555;
            min-width: 100px;
            margin-right: 10px;
        }
        
        .detail-value {
            color: #333;
            flex: 1;
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
            font-size: 1.1rem;
        }
        
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #fee;
            color: #d00;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid #fcc;
        }
        
        .no-results {
            text-align: center;
            padding: 3rem;
            color: #666;
            font-size: 1.1rem;
        }
        
        /* Hidden content for language switching */
        .lang-content {
            display: none;
        }
        
        .lang-content.active {
            display: block;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .search-controls {
                grid-template-columns: 1fr;
            }
            
            .profile-grid {
                grid-template-columns: 1fr;
            }
            
            .header .container {
                flex-direction: column;
                text-align: center;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .results-header {
                flex-direction: column;
                text-align: center;
            }
            
            .language-selector {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .search-section,
            .results-section {
                padding: 1rem;
            }
            
            .profile-card {
                padding: 1rem;
            }
        }
    </style>
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .header .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }
        
        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            color: #666;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #667eea;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .auth-required {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            text-align: center;
            color: #666;
        }
        
        .auth-required h2 {
            color: #333;
            margin-bottom: 1rem;
        }
        
        .auth-required .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
        }
        
        /* Profile browser styles */
        #profiiliselain-root {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .search-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .search-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 500;
            color: #555;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .form-group input,
        .form-group select {
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .search-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .search-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .results-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .results-header {
            background: #f8f9fa;
            padding: 20px 25px;
            border-bottom: 1px solid #e1e5e9;
        }
        
        .results-header h3 {
            color: #333;
            margin-bottom: 5px;
        }
        
        .results-count {
            color: #666;
            font-size: 0.9rem;
        }
        
        .profile-card {
            padding: 20px 25px;
            border-bottom: 1px solid #e1e5e9;
            transition: background-color 0.2s ease;
        }
        
        .profile-card:hover {
            background-color: #f8f9fa;
        }
        
        .profile-card:last-child {
            border-bottom: none;
        }
        
        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .profile-id {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .profile-content {
            display: grid;
            gap: 10px;
        }
        
        .profile-field {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .profile-field strong {
            color: #333;
            min-width: 120px;
        }
        
        .tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .cooldown-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Language Selector -->
    <div class="language-selector">
        <button onclick="switchLanguage('fi')" id="langFi" class="active">FI</button>
        <button onclick="switchLanguage('en')" id="langEn">EN</button>
    </div>

    <div class="header">
        <div class="container">
            <!-- Finnish Header -->
            <div class="lang-content active" data-lang="fi">
                <h1>üîç Profiiliselain</h1>
            </div>
            <!-- English Header -->
            <div class="lang-content" data-lang="en">
                <h1>üîç Profile Browser</h1>
            </div>
            
            <div class="nav-links">
                <span id="user-email"></span>
                <!-- Finnish Navigation -->
                <div class="lang-content active" data-lang="fi">
                    <a href="/">‚Üê Takaisin etusivulle</a>
                    <a href="#" onclick="logoutUser()">Kirjaudu ulos</a>
                </div>
                <!-- English Navigation -->
                <div class="lang-content" data-lang="en">
                    <a href="/">‚Üê Back to homepage</a>
                    <a href="#" onclick="logoutUser()">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="search-section">
            <!-- Finnish Search Section -->
            <div class="lang-content active" data-lang="fi">
                <h2>üéØ Etsi sopivia ehdokkaita</h2>
                <p style="text-align: center; margin-bottom: 1.5rem; color: #666;">
                    Selaa 27,717 henkil√∂profiilin joukosta ja l√∂yd√§ sopivat ehdokkaat LxP-koodin avulla
                </p>
            </div>
            <!-- English Search Section -->
            <div class="lang-content" data-lang="en">
                <h2>üéØ Find suitable candidates</h2>
                <p style="text-align: center; margin-bottom: 1.5rem; color: #666;">
                    Browse through 27,717 person profiles and find suitable candidates using LxP code
                </p>
            </div>
            
            <div class="search-controls">
                <!-- Finnish Form Controls -->
                <div class="lang-content active" data-lang="fi">
                    <div class="form-group">
                        <label for="lxpCode">LxP-koodi</label>
                        <input type="text" id="lxpCode" placeholder="esim. H1234" maxlength="10">
                    </div>
                    
                    <div class="form-group">
                        <label for="profession">Ammatti</label>
                        <input type="text" id="profession" placeholder="esim. ohjelmoija, opettaja">
                    </div>
                    
                    <div class="form-group">
                        <label for="education">Koulutus</label>
                        <select id="education">
                            <option value="">Kaikki koulutustasot</option>
                            <option value="peruskoulu">Peruskoulu</option>
                            <option value="lukio">Lukio</option>
                            <option value="ammattikoulu">Ammattikoulu</option>
                            <option value="amk">AMK</option>
                            <option value="yliopisto">Yliopisto</option>
                            <option value="tohtori">Tohtorintutkinto</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="location">Sijainti</label>
                        <input type="text" id="location" placeholder="esim. Helsinki, Tampere">
                    </div>
                    
                    <div class="form-group">
                        <label for="experience">Kokemus (vuotta)</label>
                        <select id="experience">
                            <option value="">Kaikki</option>
                            <option value="0-2">0-2 vuotta</option>
                            <option value="3-5">3-5 vuotta</option>
                            <option value="6-10">6-10 vuotta</option>
                            <option value="10+">Yli 10 vuotta</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="skills">Taidot</label>
                        <input type="text" id="skills" placeholder="esim. JavaScript, johtaminen">
                    </div>
                    
                    <button class="search-button" onclick="searchProfiles()">
                        üîç Hae profiileja
                    </button>
                </div>
                
                <!-- English Form Controls -->
                <div class="lang-content" data-lang="en">
                    <div class="form-group">
                        <label for="lxpCodeEn">LxP Code</label>
                        <input type="text" id="lxpCodeEn" placeholder="e.g. H1234" maxlength="10">
                    </div>
                    
                    <div class="form-group">
                        <label for="professionEn">Profession</label>
                        <input type="text" id="professionEn" placeholder="e.g. programmer, teacher">
                    </div>
                    
                    <div class="form-group">
                        <label for="educationEn">Education</label>
                        <select id="educationEn">
                            <option value="">All education levels</option>
                            <option value="peruskoulu">Primary school</option>
                            <option value="lukio">High school</option>
                            <option value="ammattikoulu">Vocational school</option>
                            <option value="amk">University of Applied Sciences</option>
                            <option value="yliopisto">University</option>
                            <option value="tohtori">Doctorate</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="locationEn">Location</label>
                        <input type="text" id="locationEn" placeholder="e.g. Helsinki, Tampere">
                    </div>
                    
                    <div class="form-group">
                        <label for="experienceEn">Experience (years)</label>
                        <select id="experienceEn">
                            <option value="">All</option>
                            <option value="0-2">0-2 years</option>
                            <option value="3-5">3-5 years</option>
                            <option value="6-10">6-10 years</option>
                            <option value="10+">Over 10 years</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="skillsEn">Skills</label>
                        <input type="text" id="skillsEn" placeholder="e.g. JavaScript, leadership">
                    </div>
                    
                    <button class="search-button" onclick="searchProfiles()">
                        üîç Search Profiles
                    </button>
                </div>
            </div>
        </div>

        <div class="results-section">
            <div class="results-header">
                <!-- Finnish Results Header -->
                <div class="lang-content active" data-lang="fi">
                    <div class="results-count" id="resultsCount">
                        Ladataan profiileja...
                    </div>
                </div>
                <!-- English Results Header -->
                <div class="lang-content" data-lang="en">
                    <div class="results-count" id="resultsCountEn">
                        Loading profiles...
                    </div>
                </div>
                
                <div class="pagination" id="pagination">
                    <!-- Pagination will be populated by JavaScript -->
                </div>
            </div>
            
            <div id="profileResults">
                <!-- Finnish Loading -->
                <div class="lang-content active" data-lang="fi">
                    <div class="loading">Ladataan profiileja...</div>
                </div>
                <!-- English Loading -->
                <div class="lang-content" data-lang="en">
                    <div class="loading">Loading profiles...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        // Firebase config - k√§ytet√§√§n samaa konfiguraatiota kuin yoro.fi
        const firebaseConfig = {
            apiKey: "AIzaSyAnfsX522_ybXR7yhnAJbxDjuszVu4rZLE",
            authDomain: "urapolku-7780a.firebaseapp.com",
            projectId: "urapolku-7780a",
            storageBucket: "urapolku-7780a.firebasestorage.app",
            messagingSenderId: "314066598772",
            appId: "1:314066598772:web:50183db006293290378a21"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <!-- Language Switching -->
    <script>
        let currentLanguage = 'fi';
        
        function switchLanguage(lang) {
            currentLanguage = lang;
            
            // Hide all language content
            document.querySelectorAll('.lang-content').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show selected language content
            document.querySelectorAll(`.lang-content[data-lang="${lang}"]`).forEach(el => {
                el.classList.add('active');
            });
            
            // Update language selector buttons
            document.getElementById('langFi').classList.toggle('active', lang === 'fi');
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
            
            // Update HTML lang attribute
            document.documentElement.lang = lang;
            
            // Update page title
            if (lang === 'en') {
                document.title = 'Profile Browser - Yoro Oy | Browse 27k+ Profiles';
            } else {
                document.title = 'Profiiliselain - Yoro Oy | Selaa 27k+ profiilia';
            }
            
            // Save language preference
            localStorage.setItem('preferred-language', lang);
            
            // Sync form values between languages
            syncFormValues(lang);
        }
        
        function syncFormValues(targetLang) {
            if (targetLang === 'en') {
                // Copy from Finnish to English
                document.getElementById('lxpCodeEn').value = document.getElementById('lxpCode').value || '';
                document.getElementById('professionEn').value = document.getElementById('profession').value || '';
                document.getElementById('educationEn').value = document.getElementById('education').value || '';
                document.getElementById('locationEn').value = document.getElementById('location').value || '';
                document.getElementById('experienceEn').value = document.getElementById('experience').value || '';
                document.getElementById('skillsEn').value = document.getElementById('skills').value || '';
            } else {
                // Copy from English to Finnish
                document.getElementById('lxpCode').value = document.getElementById('lxpCodeEn').value || '';
                document.getElementById('profession').value = document.getElementById('professionEn').value || '';
                document.getElementById('education').value = document.getElementById('educationEn').value || '';
                document.getElementById('location').value = document.getElementById('locationEn').value || '';
                document.getElementById('experience').value = document.getElementById('experienceEn').value || '';
                document.getElementById('skills').value = document.getElementById('skillsEn').value || '';
            }
        }
        
        // Load saved language preference
        function loadLanguagePreference() {
            const saved = localStorage.getItem('preferred-language');
            if (saved && saved !== currentLanguage) {
                switchLanguage(saved);
            }
        }
        
        // Enhanced search function that works with both language forms
        window.searchProfiles = function() {
            // Get values from currently active language form
            const isEnglish = currentLanguage === 'en';
            const formSuffix = isEnglish ? 'En' : '';
            
            const lxpCode = document.getElementById('lxpCode' + formSuffix).value;
            const profession = document.getElementById('profession' + formSuffix).value;
            const education = document.getElementById('education' + formSuffix).value;
            const location = document.getElementById('location' + formSuffix).value;
            const experience = document.getElementById('experience' + formSuffix).value;
            const skills = document.getElementById('skills' + formSuffix).value;
            
            // Sync values to the other language form
            syncFormValues(isEnglish ? 'fi' : 'en');
            
            const searchCriteria = {
                lxpCode,
                profession,
                education,
                location,
                experience,
                skills
            };
            
            // Call the actual search function (to be implemented)
            performSearch(searchCriteria);
        };
        
        // Initialize language switching on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadLanguagePreference();
        });
    </script>

    <!-- Authentication and Profile Browser Logic -->
    <script type="text/babel">
        const { useState, useEffect, createElement: h } = React;
        const { render } = ReactDOM;

        // Enhanced logout function with bilingual support
        window.logoutUser = function() {
            const confirmMessage = currentLanguage === 'en' ? 
                'Are you sure you want to logout?' : 
                'Haluatko varmasti kirjautua ulos?';
                
            if (confirm(confirmMessage)) {
                auth.signOut().then(() => {
                    const successMessage = currentLanguage === 'en' ? 
                        'Successfully logged out!' : 
                        'Olet kirjautunut ulos!';
                    alert(successMessage);
                    window.location.href = '/';
                }).catch((error) => {
                    console.error('Logout error:', error);
                    const errorMessage = currentLanguage === 'en' ? 
                        'Logout failed. Please try again.' : 
                        'Uloskirjautuminen ep√§onnistui. Yrit√§ uudelleen.';
                    alert(errorMessage);
                });
            }
        };

        // Profile Browser Component
        function ProfiiliSelain({ user }) {
            const [profiles, setProfiles] = useState([]);
            const [filteredProfiles, setFilteredProfiles] = useState([]);
            const [loading, setLoading] = useState(false);
            const [searchCooldown, setSearchCooldown] = useState(0);
            const [lastSearchTime, setLastSearchTime] = useState(0);
            
            const [searchCriteria, setSearchCriteria] = useState({
                esittely: '',
                tyonhakualue: '',
                ammatit: '',
                osaamiset: '',
                koulutus: '',
                kaupunki: ''
            });

            // Load profiles when component mounts
            useEffect(() => {
                if (!user) return;
                
                setLoading(true);
                console.log('Loading profiles for user:', user.email);
                
                // Load all profiles from Firestore
                db.collection('profiilit')
                    .limit(30000)
                    .get()
                    .then((querySnapshot) => {
                        const profileData = [];
                        querySnapshot.forEach((doc) => {
                            profileData.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        
                        console.log('‚úÖ Profiles loaded:', profileData.length);
                        setProfiles(profileData);
                        setFilteredProfiles(profileData.slice(0, 50)); // Show first 50 initially
                        setLoading(false);
                    })
                    .catch((error) => {
                        console.error('‚ùå Error loading profiles:', error);
                        setLoading(false);
                    });
            }, [user]);

            // Search functionality with cooldown
            const performSearch = () => {
                const now = Date.now();
                const timeSinceLastSearch = now - lastSearchTime;
                
                if (timeSinceLastSearch < 3000) {
                    const remainingTime = Math.ceil((3000 - timeSinceLastSearch) / 1000);
                    setSearchCooldown(remainingTime);
                    
                    const countdown = setInterval(() => {
                        setSearchCooldown(prev => {
                            if (prev <= 1) {
                                clearInterval(countdown);
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                    
                    return;
                }
                
                setLastSearchTime(now);
                setLoading(true);
                
                // Filter profiles based on search criteria
                let filtered = profiles;
                
                if (searchCriteria.esittely) {
                    const searchTerm = searchCriteria.esittely.toLowerCase();
                    filtered = filtered.filter(profile => 
                        profile.esittely?.toLowerCase().includes(searchTerm) ||
                        profile.osaamisteksti?.toLowerCase().includes(searchTerm)
                    );
                }
                
                if (searchCriteria.ammatit) {
                    const searchTerm = searchCriteria.ammatit.toLowerCase();
                    filtered = filtered.filter(profile => 
                        profile.ammatit?.some(ammatti => 
                            ammatti.toLowerCase().includes(searchTerm)
                        )
                    );
                }
                
                if (searchCriteria.osaamiset) {
                    const searchTerm = searchCriteria.osaamiset.toLowerCase();
                    filtered = filtered.filter(profile => 
                        profile.osaamiset?.some(osaaminen => 
                            osaaminen.toLowerCase().includes(searchTerm)
                        )
                    );
                }
                
                if (searchCriteria.koulutus) {
                    const searchTerm = searchCriteria.koulutus.toLowerCase();
                    filtered = filtered.filter(profile => 
                        profile.koulutus?.some(koulutusItem => 
                            koulutusItem.toLowerCase().includes(searchTerm)
                        )
                    );
                }
                
                if (searchCriteria.kaupunki) {
                    const searchTerm = searchCriteria.kaupunki.toLowerCase();
                    filtered = filtered.filter(profile => 
                        profile.tyonhakualue?.some(alue => 
                            alue.toLowerCase().includes(searchTerm)
                        )
                    );
                }
                
                console.log('Search results:', filtered.length);
                setFilteredProfiles(filtered.slice(0, 100)); // Limit to 100 results
                setLoading(false);
            };

            const handleInputChange = (field, value) => {
                setSearchCriteria(prev => ({
                    ...prev,
                    [field]: value
                }));
            };

            if (loading && filteredProfiles.length === 0) {
                return h('div', { className: 'loading-screen' },
                    h('div', { className: 'loading-spinner' }),
                    h('p', null, 'Ladataan profiileja...')
                );
            }

            return h('div', { id: 'profiiliselain-root' },
                // Search section
                h('div', { className: 'search-section' },
                    h('h2', null, 'üîç Hae profiileja'),
                    
                    searchCooldown > 0 && h('div', { className: 'cooldown-message' },
                        `Odota ${searchCooldown} sekuntia ennen seuraavaa hakua`
                    ),
                    
                    h('div', { className: 'search-grid' },
                        h('div', { className: 'form-group' },
                            h('label', null, 'Esittely / Osaaminen'),
                            h('input', {
                                type: 'text',
                                value: searchCriteria.esittely,
                                onChange: (e) => handleInputChange('esittely', e.target.value),
                                placeholder: 'Esim. asiakaspalvelu, myynti...'
                            })
                        ),
                        
                        h('div', { className: 'form-group' },
                            h('label', null, 'Ammatti'),
                            h('input', {
                                type: 'text',
                                value: searchCriteria.ammatit,
                                onChange: (e) => handleInputChange('ammatit', e.target.value),
                                placeholder: 'Esim. sairaanhoitaja, insin√∂√∂ri...'
                            })
                        ),
                        
                        h('div', { className: 'form-group' },
                            h('label', null, 'Osaaminen'),
                            h('input', {
                                type: 'text',
                                value: searchCriteria.osaamiset,
                                onChange: (e) => handleInputChange('osaamiset', e.target.value),
                                placeholder: 'Esim. Excel, projektinhallinta...'
                            })
                        ),
                        
                        h('div', { className: 'form-group' },
                            h('label', null, 'Koulutus'),
                            h('input', {
                                type: 'text',
                                value: searchCriteria.koulutus,
                                onChange: (e) => handleInputChange('koulutus', e.target.value),
                                placeholder: 'Esim. tradenomi, yliopisto...'
                            })
                        ),
                        
                        h('div', { className: 'form-group' },
                            h('label', null, 'Kaupunki / Alue'),
                            h('input', {
                                type: 'text',
                                value: searchCriteria.kaupunki,
                                onChange: (e) => handleInputChange('kaupunki', e.target.value),
                                placeholder: 'Esim. Helsinki, Tampere...'
                            })
                        )
                    ),
                    
                    h('button', {
                        className: 'search-btn',
                        onClick: performSearch,
                        disabled: loading || searchCooldown > 0
                    }, loading ? 'Hakee...' : 'Hae profiileja')
                ),
                
                // Results section
                h('div', { className: 'results-section' },
                    h('div', { className: 'results-header' },
                        h('h3', null, 'Hakutulokset'),
                        h('div', { className: 'results-count' },
                            `${filteredProfiles.length} profiilia l√∂ytyi (${profiles.length} yhteens√§)`
                        )
                    ),
                    
                    filteredProfiles.length === 0 ? 
                        h('div', { className: 'no-results' },
                            h('p', null, 'Ei hakutuloksia. Kokeile erilaisia hakusanoja.')
                        ) :
                        filteredProfiles.map((profile, index) =>
                            h('div', { key: profile.id, className: 'profile-card' },
                                h('div', { className: 'profile-header' },
                                    h('div', { className: 'profile-id' }, `#${profile.sequentialId || index + 1}`)
                                ),
                                
                                h('div', { className: 'profile-content' },
                                    profile.esittely && h('div', { className: 'profile-field' },
                                        h('strong', null, 'Esittely:'),
                                        h('span', null, profile.esittely)
                                    ),
                                    
                                    profile.ammatit && profile.ammatit.length > 0 && h('div', { className: 'profile-field' },
                                        h('strong', null, 'Ammatit:'),
                                        ...profile.ammatit.slice(0, 5).map((ammatti, i) =>
                                            h('span', { key: i, className: 'tag' }, ammatti)
                                        )
                                    ),
                                    
                                    profile.osaamiset && profile.osaamiset.length > 0 && h('div', { className: 'profile-field' },
                                        h('strong', null, 'Osaamiset:'),
                                        ...profile.osaamiset.slice(0, 8).map((osaaminen, i) =>
                                            h('span', { key: i, className: 'tag' }, osaaminen)
                                        )
                                    ),
                                    
                                    profile.koulutus && profile.koulutus.length > 0 && h('div', { className: 'profile-field' },
                                        h('strong', null, 'Koulutus:'),
                                        ...profile.koulutus.slice(0, 3).map((koulutusItem, i) =>
                                            h('span', { key: i, className: 'tag' }, koulutusItem)
                                        )
                                    ),
                                    
                                    profile.tyonhakualue && profile.tyonhakualue.length > 0 && h('div', { className: 'profile-field' },
                                        h('strong', null, 'Ty√∂nhakualue:'),
                                        ...profile.tyonhakualue.slice(0, 3).map((alue, i) =>
                                            h('span', { key: i, className: 'tag' }, alue)
                                        )
                                    )
                                )
                            )
                        )
                )
            );
        }

        // Main App Component
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((currentUser) => {
                    console.log('Auth state changed:', currentUser);
                    setUser(currentUser);
                    setLoading(false);
                    
                    if (currentUser) {
                        document.getElementById('user-email').textContent = currentUser.email;
                    }
                });

                return () => unsubscribe();
            }, []);

            if (loading) {
                return h('div', { className: 'loading-screen' },
                    h('div', { className: 'loading-spinner' }),
                    h('p', null, 'Tarkistetaan kirjautumistietoja...')
                );
            }

            if (!user) {
                return h('div', { className: 'auth-required' },
                    h('h2', null, 'üîê Kirjautuminen vaaditaan'),
                    h('p', null, 'Sinun t√§ytyy kirjautua sis√§√§n n√§hd√§ksesi profiiliselain.'),
                    h('div', null,
                        h('a', { href: '/kirjaudu', className: 'btn' }, 'Kirjaudu sis√§√§n'),
                        h('a', { href: '/rekisteroidy', className: 'btn' }, 'Rekister√∂idy')
                    )
                );
            }

            return h(ProfiiliSelain, { user });
        }

        // Render the app
        render(h(App), document.getElementById('main-content'));
    </script>
</body>
</html>
