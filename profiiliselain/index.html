<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Profile Browser - Yoro Oy | Profiiliselain</title>
    
    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .auth-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .search-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .search-box button {
            padding: 10px 20px;
            background: #007acc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .search-box button:hover {
            background: #005c99;
        }

        .profile-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .profile-field {
            margin-bottom: 10px;
        }

        .profile-field strong {
            color: #007acc;
            margin-right: 10px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #007acc;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
        }

        .btn:hover {
            background: #005c99;
        }

        .btn-logout {
            background: #dc3545;
        }

        .btn-logout:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üë• Profiiliselain - Yoro Oy</h1>
            <p>Selaa ja etsi sopivia ehdokkaita profiilitietokannasta</p>
        </div>

        <div class="auth-section" id="auth-section">
            <div id="not-logged-in" style="display: none;">
                <h2>üîê Kirjautuminen vaaditaan</h2>
                <p>Sinun t√§ytyy kirjautua sis√§√§n n√§hd√§ksesi profiilit.</p>
                <a href="/kirjaudu/" class="btn">Kirjaudu sis√§√§n</a>
                <a href="/" class="btn">Takaisin etusivulle</a>
            </div>
            <div id="logged-in" style="display: none;">
                <p>Kirjautunut k√§ytt√§j√§: <span id="user-email"></span></p>
                <button onclick="logoutUser()" class="btn btn-logout">Kirjaudu ulos</button>
                <a href="/" class="btn">Takaisin etusivulle</a>
            </div>
        </div>

        <div id="main-content" style="display: none;">
            <div class="search-section">
                <h2>üîç Hae profiileja</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Hae profiileista (esittely, ammatit, osaamiset, koulutus...)">
                    <button onclick="searchProfiles()">Hae</button>
                </div>
                <p id="results-count"></p>
            </div>

            <div id="loading" class="loading" style="display: none;">
                <p>‚è≥ Ladataan profiileja...</p>
            </div>

            <div id="profiles-container">
                <!-- Profiles will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAnfsX522_ybXR7yhnAJbxDjuszVu4rZLE",
            authDomain: "urapolku-7780a.firebaseapp.com",
            projectId: "urapolku-7780a",
            storageBucket: "urapolku-7780a.firebasestorage.app",
            messagingSenderId: "314066598772",
            appId: "1:314066598772:web:50183db006293290378a21"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let allProfiles = [];
        let currentUser = null;

        // Authentication state listener
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if (user) {
                console.log('User logged in:', user.email);
                document.getElementById('user-email').textContent = user.email;
                document.getElementById('not-logged-in').style.display = 'none';
                document.getElementById('logged-in').style.display = 'block';
                document.getElementById('main-content').style.display = 'block';
                loadProfiles();
            } else {
                console.log('User not logged in');
                document.getElementById('not-logged-in').style.display = 'block';
                document.getElementById('logged-in').style.display = 'none';
                document.getElementById('main-content').style.display = 'none';
            }
        });

        // Logout function
        function logoutUser() {
            auth.signOut().then(() => {
                console.log('User logged out');
                window.location.href = '/';
            });
        }

        // Load all profiles
        function loadProfiles() {
            document.getElementById('loading').style.display = 'block';
            
            db.collection('profiilit')
                .limit(30000)
                .get()
                .then((querySnapshot) => {
                    allProfiles = [];
                    querySnapshot.forEach((doc) => {
                        allProfiles.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    console.log('‚úÖ Profiles loaded:', allProfiles.length);
                    document.getElementById('results-count').textContent = `Yhteens√§ ${allProfiles.length} profiilia`;
                    displayProfiles(allProfiles.slice(0, 10)); // Show first 10
                    document.getElementById('loading').style.display = 'none';
                })
                .catch((error) => {
                    console.error('‚ùå Error loading profiles:', error);
                    document.getElementById('loading').style.display = 'none';
                    alert('Virhe profiilien lataamisessa: ' + error.message);
                });
        }

        // Search profiles
        function searchProfiles() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchTerm) {
                displayProfiles(allProfiles.slice(0, 10));
                return;
            }

            document.getElementById('loading').style.display = 'block';
            
            const filtered = allProfiles.filter(profile => {
                return (
                    (profile.esittely && profile.esittely.toLowerCase().includes(searchTerm)) ||
                    (profile.esittely_10sanaa && profile.esittely_10sanaa.toLowerCase().includes(searchTerm)) ||
                    (profile.osaamisteksti && profile.osaamisteksti.toLowerCase().includes(searchTerm)) ||
                    (profile.tyonhakualue && profile.tyonhakualue.toLowerCase().includes(searchTerm)) ||
                    (profile.ammatit && profile.ammatit.some(ammatti => ammatti.toLowerCase().includes(searchTerm))) ||
                    (profile.osaamiset && profile.osaamiset.some(osaaminen => osaaminen.toLowerCase().includes(searchTerm))) ||
                    (profile.ty√∂toiveet && profile.ty√∂toiveet.some(toive => toive.toLowerCase().includes(searchTerm))) ||
                    (profile.koulutus && profile.koulutus.some(koulutusItem => koulutusItem.toLowerCase().includes(searchTerm))) ||
                    (profile.muu_kokemus && profile.muu_kokemus.some(kokemus => kokemus.toLowerCase().includes(searchTerm))) ||
                    (profile.kielitaito && profile.kielitaito.some(kieli => kieli.toLowerCase().includes(searchTerm))) ||
                    (profile.ajokortit && profile.ajokortit.some(kortti => kortti.toLowerCase().includes(searchTerm))) ||
                    (profile.lupatiedot && profile.lupatiedot.some(lupa => lupa.toLowerCase().includes(searchTerm)))
                );
            });

            document.getElementById('results-count').textContent = `L√∂ytyi ${filtered.length} profiilia haulla "${searchTerm}"`;
            displayProfiles(filtered.slice(0, 50)); // Show max 50 results
            document.getElementById('loading').style.display = 'none';
        }

        // Display profiles
        function displayProfiles(profiles) {
            const container = document.getElementById('profiles-container');
            container.innerHTML = '';

            if (profiles.length === 0) {
                container.innerHTML = '<div class="profile-card"><p>Ei tuloksia hakuehdoilla.</p></div>';
                return;
            }

            profiles.forEach((profile, index) => {
                const card = document.createElement('div');
                card.className = 'profile-card';
                
                let html = `<h3>Profiili #${profile.id || index + 1}</h3>`;
                
                // All the profile fields
                if (profile.esittely) html += `<div class="profile-field"><strong>Esittely:</strong> ${profile.esittely}</div>`;
                if (profile.esittely_10sanaa) html += `<div class="profile-field"><strong>Esittely (10 sanaa):</strong> ${profile.esittely_10sanaa}</div>`;
                if (profile.tyonhakualue) html += `<div class="profile-field"><strong>Ty√∂nhakualue:</strong> ${profile.tyonhakualue}</div>`;
                if (profile.aloitusajankohta) html += `<div class="profile-field"><strong>Aloitusajankohta:</strong> ${profile.aloitusajankohta}</div>`;
                if (profile.ammatit) html += `<div class="profile-field"><strong>Ammatit:</strong> ${Array.isArray(profile.ammatit) ? profile.ammatit.join(', ') : profile.ammatit}</div>`;
                if (profile.osaamiset) html += `<div class="profile-field"><strong>Osaamiset:</strong> ${Array.isArray(profile.osaamiset) ? profile.osaamiset.join(', ') : profile.osaamiset}</div>`;
                if (profile.ty√∂toiveet) html += `<div class="profile-field"><strong>Ty√∂toiveet:</strong> ${Array.isArray(profile.ty√∂toiveet) ? profile.ty√∂toiveet.join(', ') : profile.ty√∂toiveet}</div>`;
                if (profile.koulutus) html += `<div class="profile-field"><strong>Koulutus:</strong> ${Array.isArray(profile.koulutus) ? profile.koulutus.join(', ') : profile.koulutus}</div>`;
                if (profile.muu_kokemus) html += `<div class="profile-field"><strong>Muu kokemus:</strong> ${Array.isArray(profile.muu_kokemus) ? profile.muu_kokemus.join(', ') : profile.muu_kokemus}</div>`;
                if (profile.osaamisteksti) html += `<div class="profile-field"><strong>Osaamisteksti:</strong> ${profile.osaamisteksti}</div>`;
                if (profile.kielitaito) html += `<div class="profile-field"><strong>Kielitaito:</strong> ${Array.isArray(profile.kielitaito) ? profile.kielitaito.join(', ') : profile.kielitaito}</div>`;
                if (profile.ajokortit) html += `<div class="profile-field"><strong>Ajokortit:</strong> ${Array.isArray(profile.ajokortit) ? profile.ajokortit.join(', ') : profile.ajokortit}</div>`;
                if (profile.ajotiedot) html += `<div class="profile-field"><strong>Ajotiedot:</strong> ${profile.ajotiedot}</div>`;
                if (profile.lupatiedot) html += `<div class="profile-field"><strong>Lupatiedot:</strong> ${Array.isArray(profile.lupatiedot) ? profile.lupatiedot.join(', ') : profile.lupatiedot}</div>`;
                if (profile.some) html += `<div class="profile-field"><strong>Sosiaalinen media:</strong> ${profile.some}</div>`;
                if (profile.puhelin) html += `<div class="profile-field"><strong>Puhelin:</strong> ${profile.puhelin}</div>`;
                if (profile.s√§hk√∂posti) html += `<div class="profile-field"><strong>S√§hk√∂posti:</strong> ${profile.s√§hk√∂posti}</div>`;
                
                card.innerHTML = html;
                container.appendChild(card);
            });
        }

        // Enter key support for search
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProfiles();
                }
            });
        });
    </script>
</body>
</html>
